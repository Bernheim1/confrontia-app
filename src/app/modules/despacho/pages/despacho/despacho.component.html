<div class="w-full">
  <div *ngIf="this.step == 0">
    <app-ingreso-despacho class="scale-up-ver-top" (textoIngresado)="onTextoIngresado($event)" (tipoSalidaOutput)="onTipoSalidaSeleccionado($event)" (subtipoSalidaOutput)="onSubtipoSalidaSeleccionado($event)"></app-ingreso-despacho>
  </div>

  <div *ngIf="this.step == 1">
    <div *ngFor="let despacho of despachos; let i = index" class="mb-6">
      <app-seleccion-salida 
        (salidaSeleccionada)="onSalidaSeleccionada($event)"
        (formularioCompletado)="onFormularioCompletado($event)"
        (reingresar)="onReingresar()" 
        [textoDespacho]="despacho.primerDespacho" 
        [tipoSalida]="this.tipoSalida" 
        [subtipoSalida]="this.subtipoSalida"
        [index]="i"
        [masivo]="despachos.length > 1"
        [totalDespachos]="despachos.length"
        [despachosCompletados]="formulariosValidos.size">
      </app-seleccion-salida>
    </div>
    
    <!-- Botón flotante para generar todos -->
    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[60] flex gap-3">
        <button type="submit" (click)="generarTodos()" class="px-6 py-3 text-white bg-primary-600 hover:bg-primary-700 active:bg-primary-800 rounded-xl font-medium shadow-xl transition-all duration-200 hover:scale-[1.02]" type="button">
          <span >Generar <span class="font-bold">{{ tipoSalida == 1 ? 'Cédula' : 'Mandamiento' }}</span></span>
        </button>
        <button type="button" (click)="onReingresar()"
          class="px-4 py-3 text-white bg-gray-600 hover:bg-gray-700 active:bg-gray-800 rounded-xl shadow-xl transition-all duration-200 hover:scale-[1.02]"
          title="Reingresar">
          <fa-icon [icon]="faRepeat"></fa-icon>
        </button>
    </div>
  </div>

  <div *ngIf="this.step == 2">
    <div *ngFor="let despacho of despachos; let i = index" class="mb-6">
      <app-mostrar-salida [tipoSalida]="this.tipoSalida" [salida]="this.salida[i]" [textoDespacho]="despacho.primerDespacho" [masivo]="despachos.length > 1"></app-mostrar-salida>
    </div>
  </div>
</div>
